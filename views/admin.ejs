<!DOCTYPE html>
<html>
<head>
  <title>Admin - Achievement Control</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/style.css">
</head>
<body class="container mt-5">
  <% let teams = []; %>
  <h1>ðŸ›  Admin Panel</h1>
  <h2 class="mt-5">Bulk Assign Achievements</h2>
<form method="POST" action="/admin123" class="row g-3 mb-4">
  <input type="hidden" name="bulkAssign" value="1">

  <div class="col-md-4">
    <label for="achievementId" class="form-label">Achievement</label>
    <select name="achievementId" class="form-select" required>
      <% achievements.forEach(a => { %>
        <option value="<%= a.id %>"><%= a.title %> (<%= a.points %> pts)</option>
      <% }) %>
    </select>
  </div>

  <div class="col-md-4">
    <label for="team" class="form-label">Team</label>
    <select name="team" class="form-select" required>
      <option value="All">All Teams</option>
      <% students.forEach(s => { %>
        <% if (!teams.includes(s.team)) teams.push(s.team); %>
      <% }) %>
      <% teams.forEach(t => { %>
        <option value="<%= t %>"><%= t %> Team</option>
      <% }) %>
    </select>
  </div>

  <div class="col-md-4 d-flex align-items-end">
    <button type="submit" class="btn btn-warning w-100">Bulk Assign</button>
  </div>
</form>


  <form method="GET" action="/admin123" class="mb-4">
    <label for="pseudonym" class="form-label">Select Student</label>
    <select name="pseudonym" id="pseudonym" class="form-select" onchange="this.form.submit()">
      <option value="">-- Choose --</option>
      <% students.forEach(s => { %>
        <option value="<%= s.pseudonym %>" <%= selectedStudent?.pseudonym === s.pseudonym ? 'selected' : '' %>>
          <%= s.pseudonym %>
        </option>
      <% }) %>
    </select>
  </form>

  <% if (selectedStudent) { %>
    <h2>Editing: <%= selectedStudent.pseudonym %></h2>
    <form method="POST" action="/admin123">
      <input type="hidden" name="pseudonym" value="<%= selectedStudent.pseudonym %>">
      <% achievements.forEach(a => { %>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="unlocked" value="<%= a.id %>" id="ach-<%= a.id %>"
            <%= unlocked.includes(a.id) ? 'checked' : '' %>>
          <label class="form-check-label" for="ach-<%= a.id %>">
            <strong><%= a.title %></strong> - <%= a.description %> (<%= a.points %> pts)
          </label>
        </div>
      <% }) %>
      <button class="btn btn-success mt-3" type="submit">Save</button>
    </form>
  <% } %>
</body>
</html>